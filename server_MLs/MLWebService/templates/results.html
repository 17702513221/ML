<!doctype html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8">
<title>Machine Learning</title>
{% load staticfiles %}
<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
<script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script></script>
</head>
<body>
    <nav class="navbar navbar-inverse ">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                  <span class="icon-bar"></span>
                   <span class="icon-bar"></span>
                     <span class="icon-bar"></span>                        
               </button>
                    <a class="navbar-brand" href="#">机器学习训练服务</a>
                  </div>
                  <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav">
                      <li ><a href="/MLWebService/index">上传训练数据</a></li>
                      <li><a href="/MLWebService/tasks">管理训练任务</a></li>
                    </ul>
                  </div>
                </div>
            </nav>
    <h2>机器学习训练任务管理</h2>
        <table class="table" id='oTabel'>
            <caption>测试结果</caption>
            <br>
            <tbody>
                {% for result in data %}
                    <tr>
                        {%for fea in result%}
                        <td>{{fea}}</td>
                        {% endfor%}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <button class="btn btn-default" id = "download">下载测试结果</button>
</body>
<script>
    $("#download").on("click", function() {
        console.log("miaomiaomiao?")
        var result = ""
        $("#oTabel tr").each(function (key, value) {
            $(this).find("td").each(function (key, value) {
                result+=$(this).html()
                result+=","
            });
            result+="\n"
        //arr.push($(this).html());
        });
        var urlObject = window.URL || window.webkitURL || window;
　　　   var export_blob = new Blob(["\ufeff" +result]);
　　　　 var save_link = document.createElementNS("http://www.w3.org/1999/xhtml", "a")
　　　　 save_link.href = urlObject.createObjectURL(export_blob);
　　　　 save_link.download = "test.csv";
　　　　 fakeClick(save_link);

        console.log(result)
        //console.log(trl.length) 

            
        //window.location.href = 'data:text/csv;charset=UTF-8,\ufeff'
            //+ encodeURIComponent(csv);
    });
    function fakeClick(obj) { 
        　　var ev = document.createEvent("MouseEvents");
    　　　　ev.initMouseEvent("click", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
    　　　　obj.dispatchEvent(ev);
    　　};
</script>